os: osx
language: objective-c
sudo: false

env:
  global:
    # $THEOS is absolutely needed for theos to even be found
    - THEOS=~/theos

before_install:
  # update homebrew and install dependencies
  - brew update
  - brew install dpkg ldid
  
  # install theos
  - git clone --recursive git://github.com/theos/theos.git ~/theos

script:
  # build!
  - make package FINALPACKAGE=1

before_deploy:
  # Set up git user name and tag this commit
  - git config --local user.name "Muirey03"
  - git config --local user.email "tommy.muir@btinternet.com"
  - export TRAVIS_TAG=${TRAVIS_TAG:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  skip_cleanup: true
  file: "./packages/com.muirey03.powermodule_1.2.3_iphoneos-arm.deb"
  on:
    repo: Muirey03/PowerModule
    branch: master